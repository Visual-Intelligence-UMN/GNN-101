(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[432],{5107:function(t,a,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/node_classifier/NodeGraphVisualizer",function(){return e(1290)}])},1290:function(t,a,e){"use strict";e.r(a);var n=e(5893),r=e(7294),o=e(2434),c=e(7340),l=e(4801),s=e(5725),i=e(3164),u=e(5108);const y=t=>{let{graph_path:a,intmData:e,changed:y,predicted:f,selectedButtons:d,simulationLoading:x,setSimulation:h}=t;const p=(0,r.useRef)(null),[g,m]=(0,r.useState)(!0),w=(0,r.useRef)(e),k=(0,r.useRef)(null),v=(0,r.useRef)(1);null!=e&&u.log("From Visualizer:",e),(0,r.useEffect)((()=>{h(!1);const t=++v.current,n=async(t,n)=>{null!=e&&u.log("From Visualizer:",e),u.log("path",a);let r=[];const l=600,y=10,f=undefined,d=undefined,x=undefined,h=4800-40-30,p=1e3-y-30;o.Ys("#my_dataviz").selectAll("svg").remove();const g=o.Ys("#my_dataviz").append("svg").attr("width",h).attr("height",p);k.current=g.node();let w=[];t.forEach(((a,f)=>{if(f>=5)return;u.log("i",f),u.log(a);let d=(f-2.5)*l;const x=g.append("g").attr("class","layerVis").attr("transform","translate(".concat(d,",").concat(y,")")).attr("layerNum",f),k=x.selectAll("line").data(a.links).join("line").style("stroke","#aaa"),v=x.selectAll("circle").data(a.nodes).join("circle").attr("r",17).style("fill","white").style("stroke","#69b3a2").style("stroke-width",1).style("stroke-opacity",1).attr("opacity",1),b=x.selectAll("text").data(a.nodes).join("text").text((t=>t.id)).attr("font-size","17px");function _(){const t=o.Wem(a.links,(t=>t.weight)),e=o.BYU().domain(t).range([1,10]),n=o.BYU().domain(t).range([.1,1]);k.attr("x1",(t=>t.source.x)).attr("y1",(t=>t.source.y)).attr("x2",(t=>t.target.x)).attr("y2",(t=>t.target.y)).attr("transform",(function(t){if("double"===t.type){const a=t.target.x-t.source.x,e=t.target.y-t.source.y,n=Math.sqrt(a*a+e*e),r=undefined,o=-a/n*5;return"translate(".concat(e/n*5,", ").concat(o,")")}return null})).style("stroke",(function(t){return"aromatic"===t.type?"purple":"#aaa"})),v.attr("cx",(t=>t.x)).attr("cy",(t=>t.y)),b.attr("x",(t=>t.x-6)).attr("y",(t=>t.y+6))}function E(){k.attr("x1",(t=>t.source.x)).attr("y1",(t=>t.source.y)).attr("x2",(t=>t.target.x)).attr("y2",(t=>t.target.y)).attr("transform",(function(t){if("double"===t.type){const a=t.target.x-t.source.x,e=t.target.y-t.source.y,n=Math.sqrt(a*a+e*e),r=undefined,o=-a/n*5;return"translate(".concat(e/n*5,", ").concat(o,")")}return null})).style("stroke",(function(t){return"aromatic"===t.type?"purple":"#aaa"})),v.attr("cx",(t=>t.x)).attr("cy",(t=>t.y)),b.attr("x",(t=>t.x-6)).attr("y",(t=>t.y+6));let n=null;null!=e&&(1===f&&(n=e.conv1),2===f&&(n=e.conv2),3===f&&(n=e.conv3),4===f&&(n=e.result),5===f&&(n=e.final)),a.nodes.forEach((t=>{t.graphIndex=f,null!=n&&f<=2&&n instanceof Float32Array&&(t.features=n.subarray(4*t.id,4*(t.id+1))),null!=n&&f>2&&f<4&&n instanceof Float32Array&&(t.features=n.subarray(2*t.id,2*(t.id+1))),null!=n&&f>2&&4===f&&(t.features=n[t.id]),null!=n&&f>2&&5===f&&n instanceof Float32Array&&(t.features=n.subarray(4*t.id,4*(t.id+1))),r.push(t)}));let o=0,y=0;const d=a.nodes.slice(0,35);d.forEach((t=>{d.forEach((a=>{if(t!==a){const e=Math.abs(t.x-a.x),n=Math.abs(t.y-a.y);e>o&&(o=e),n>y&&(y=n)}}))}));const h=o+20,m=y+20,_={x:1800,y:p/8},E={x:1740,y:p/20},A={x:1740,y:p/1.7},z={x:1800,y:p/1.5},N=Math.abs(_.x-E.x),M=Math.abs(_.y-z.y),V=(_.x+A.x)/2,F=(_.y+A.y)/2,Y=140;let C=(h+Y+20)/N,R=(m+Y+20)/M,j="translate(".concat(V,", ").concat(F,") scale(").concat(C,", ").concat(R,") translate(").concat(-V,", ").concat(-F,")");h+Y<N&&m+Y<M&&(j="scale(1, 1)");const B=_.x,G=z.y+100;if(f<5){const t=x.append("polygon").attr("points","".concat(_.x,",").concat(_.y," ").concat(E.x,",").concat(E.y," ").concat(A.x,",").concat(A.y," ").concat(z.x,",").concat(z.y)).attr("stroke","black").attr("fill","none").attr("transform",j)}let I=" ";0==f&&(I="Input"),f<=3&&0!=f&&(I="GCNGconv".concat(f)),4===f&&(I="Prediction Result");const L=x.append("text").attr("class","layer-label").attr("x",_.x).attr("y",z.y+100).attr("text-anchor","middle").attr("fill","black").attr("font-size","15px").text(I).attr("font-weight","normal").attr("opacity",.5);if(4===f&&n){let t=[];n.forEach((a=>{t=t.concat(Array.from(a))})),n=t}let S=1;null!=n&&(S=(0,i.qg)(n));let T=null;0==f?T=(0,s.T1)(c.LV,0,1,I+" Color Scheme",B,G+50,x):(u.log("AWD",n,S,I,f),T=(0,s.oh)(c.LV,S,I+" Color Scheme",B-50,G+50,x)),w.push(T),f===t.length-3&&((0,c.gL)(r,g,t,l,1),e&&e.final&&(0,c.Ts)(g,r,l,p,t,900,600,15,10,20,20,w,1))}f>=5&&(b.attr("opacity",0),v.attr("opacity",0)),a.nodes.forEach((t=>{n[t.id]?(t.x=n[t.id].x,t.y=n[t.id].y):(t.x=Math.random()*h,t.y=Math.random()*p)})),o.A4v(a.nodes).force("link",o.Fsl(a.links).id((t=>t.id)).distance(20)).stop().on("tick",_),E(),m(!1)}))},r=t=>{t===v.current&&h(!0)},d=async()=>{null!=e&&!y||f?(await x(5),r(t)):await(0,l.Ew)(a,(()=>r(t)),!1,1)},x=async t=>{try{m(!0);const e=await(0,c.wb)(a),r=await(0,c.Ke)(t,e),o=(0,l.IO)();await n(r,o)}catch(t){u.error("Error in visualizeGNN:",t)}finally{m(!1)}};d()}),[a,e]);const b=(t,a)=>{o.Ys(t).selectAll(".layerVis").each((function(t,e){const n=undefined;o.Ys(this).selectAll("text.layer-label").transition().duration(140).style("opacity",(()=>e<=2&&a[e]||3===e&&a[4]||4===e&&a[5]||5===e&&a[6]?1:.5)).attr("font-size",(()=>e<=2&&a[e]||3===e&&a[4]||4===e&&a[5]||5===e&&a[6]?"18px":"15px"))}))};return(0,r.useEffect)((()=>{k.current&&!g&&b(k.current,d),u.log("selectBtn",d)}),[d,g]),(0,n.jsx)("div",{id:"my_dataviz",ref:p,style:{width:"100%",display:"flex",flexDirection:"column",alignItems:"start",height:"auto",overflow:"auto",overflowX:"scroll"}})};a.default=y}},function(t){var a=function(a){return t(t.s=a)};t.O(0,[958,978,785,164,888,774,179],(function(){return a(5107)}));var e=t.O();_N_E=e}]);